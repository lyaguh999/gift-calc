<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Подарки — калькулятор</title>
  <style>
    :root { --bg:#0b1220; --card:#121b2e; --text:#e8eefc; --muted:#aab6d3; --line:#233152; --accent:#4ea1ff; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg), #0a1020); color: var(--text);
      padding: 24px;
    }
    .wrap { max-width: 1100px; margin: 0 auto; }
    h1 { font-size: 20px; margin: 0 0 12px; }

    .layout {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 14px;
      align-items: start;
    }

    .card {
      background: rgba(18,27,46,0.92);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    .top {
      display: grid;
      grid-template-columns: 1fr 260px;
      gap: 12px;
      align-items: end;
      margin-bottom: 12px;
    }

    label { display:block; color: var(--muted); font-size: 13px; margin: 0 0 6px; }

    input {
      width: 100%;
      box-sizing: border-box;
      background: #0c1428;
      border: 1px solid var(--line);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 10px;
      outline: none;
      font-variant-numeric: tabular-nums;
    }
    input:focus {
      border-color: rgba(78,161,255,0.7);
      box-shadow: 0 0 0 3px rgba(78,161,255,0.15);
    }
    .num { text-align: right; }

    /* readonly поле количества для "Другой Подарок" */
    .readonly {
      background: rgba(12,20,40,0.55);
      color: rgba(232,238,252,0.95);
      cursor: not-allowed;
    }

    .hint { color: var(--muted); font-size: 13px; line-height: 1.35; }
    button {
      background: transparent; color: var(--text); border: 1px solid var(--line);
      padding: 10px 12px; border-radius: 10px; cursor: pointer;
    }

    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid var(--line); padding: 10px 8px; vertical-align: middle; }
    th { color: var(--muted); font-weight: 650; text-align: left; font-size: 13px; }
    td:last-child, th:last-child { text-align: right; }
    .row-total { font-weight: 750; font-variant-numeric: tabular-nums; }

    .footer {
      display:flex; justify-content: space-between; align-items: center; gap: 12px;
      margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--line);
      flex-wrap: wrap;
    }
    .grand { font-size: 18px; font-weight: 850; font-variant-numeric: tabular-nums; }

    /* Правый блок подсчета */
    .side-title { font-weight: 800; margin: 0 0 10px; }
    .side-grid { display: grid; gap: 10px; }
    .side-row { display: grid; grid-template-columns: 1fr 120px; gap: 10px; align-items: center; }
    .eq {
      margin-top: 6px;
      padding: 10px;
      border: 1px dashed var(--line);
      border-radius: 12px;
      background: rgba(12,20,40,0.35);
      font-variant-numeric: tabular-nums;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
    .eq .lhs { color: var(--muted); }
    .eq .rhs { font-weight: 900; }

    @media (max-width: 980px) {
      .layout { grid-template-columns: 1fr; }
      .top { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Калькулятор подарков</h1>

    <div class="layout">
      <!-- ЛЕВАЯ ЧАСТЬ: таблица -->
      <div class="card">
        <div class="top">
          <div class="hint">
            Введите «Цена за 1 шт для всех» — она применится ко всем товарам.<br>
            Количество для <b>«Другой Подарок»</b> берётся автоматически из блока справа: сумма 3 полей.
          </div>

          <div>
            <label for="globalPrice">Цена за 1 шт для всех</label>
            <input id="globalPrice" class="num" inputmode="decimal" placeholder="0.00" />
            <div style="margin-top:10px;">
              <button id="resetBtn" type="button">Сбросить</button>
            </div>
          </div>
        </div>

        <table aria-label="Таблица товаров">
          <thead>
            <tr>
              <th style="width:40%">Товар</th>
              <th style="width:20%">Цена за 1 шт</th>
              <th style="width:15%">Кол-во</th>
              <th style="width:25%">Итого</th>
            </tr>
          </thead>

          <tbody id="tbody">
            <tr>
              <td>Огромный подарок</td>
              <td><input class="price num" inputmode="decimal" placeholder="0.00" /></td>
              <td><input class="qty num" inputmode="decimal" value="1" /></td>
              <td class="row-total num">0.00</td>
            </tr>

            <tr>
              <td>Большой подарок</td>
              <td><input class="price num" inputmode="decimal" placeholder="0.00" /></td>
              <td><input class="qty num" inputmode="decimal" value="1" /></td>
              <td class="row-total num">0.00</td>
            </tr>

            <tr>
              <td>Другой Подарок</td>
              <td><input class="price num" inputmode="decimal" placeholder="0.00" /></td>
              <td>
                <input id="otherQty" class="qty num readonly" inputmode="decimal" value="0" readonly />
              </td>
              <td class="row-total num">0.00</td>
            </tr>
          </tbody>
        </table>

        <div class="footer">
          <div class="hint">Итог считается автоматически при изменении цены или количества.</div>
          <div class="grand">Общая сумма: <span id="grandTotal">0.00</span></div>
        </div>
      </div>

      <!-- ПРАВАЯ ЧАСТЬ: подсчет мелких подарков -->
      <div class="card">
        <h2 class="side-title">Подсчет мелких подарков</h2>

        <div class="side-grid">
          <div class="side-row">
            <div class="hint">Количество 1</div>
            <input id="small1" class="num" inputmode="decimal" value="0" />
          </div>

          <div class="side-row">
            <div class="hint">Количество 2</div>
            <input id="small2" class="num" inputmode="decimal" value="0" />
          </div>

          <div class="side-row">
            <div class="hint">Количество 3</div>
            <input id="small3" class="num" inputmode="decimal" value="0" />
          </div>

          <div class="eq" aria-label="Формула суммы">
            <div class="lhs">
              <span id="eqA">0</span> + <span id="eqB">0</span> + <span id="eqC">0</span> =
            </div>
            <div class="rhs">
              <span id="eqSum">0</span>
            </div>
          </div>

          <div class="hint">
            Эта сумма автоматически подставляется в <b>«Другой Подарок → Кол-во»</b>.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const tbody = document.getElementById('tbody');
    const grandTotalEl = document.getElementById('grandTotal');
    const globalPriceEl = document.getElementById('globalPrice');
    const resetBtn = document.getElementById('resetBtn');

    const otherQtyEl = document.getElementById('otherQty');

    const small1El = document.getElementById('small1');
    const small2El = document.getElementById('small2');
    const small3El = document.getElementById('small3');

    const eqAEl = document.getElementById('eqA');
    const eqBEl = document.getElementById('eqB');
    const eqCEl = document.getElementById('eqC');
    const eqSumEl = document.getElementById('eqSum');

    function parseNumber(value) {
      if (typeof value !== 'string') return 0;
      const cleaned = value.trim().replace(/\s+/g, '').replace(',', '.');
      const n = Number.parseFloat(cleaned);
      return Number.isFinite(n) ? Math.max(0, n) : 0;
    }

    function fmt(n) {
      return (Math.round(n * 100) / 100).toFixed(2);
    }

    function fmtQty(n) {
      // количество выводим без .00 если целое, иначе как есть
      if (Number.isInteger(n)) return String(n);
      const rounded = Math.round(n * 100) / 100;
      return String(rounded);
    }

    function updateSmallGiftsSum() {
      const a = parseNumber(small1El.value);
      const b = parseNumber(small2El.value);
      const c = parseNumber(small3El.value);
      const sum = a + b + c;

      eqAEl.textContent = fmtQty(a);
      eqBEl.textContent = fmtQty(b);
      eqCEl.textContent = fmtQty(c);
      eqSumEl.textContent = fmtQty(sum);

      // Вводим ответ только в "Другой Подарок" -> количество
      otherQtyEl.value = fmtQty(sum);

      recalc();
    }

    function recalc() {
      let grand = 0;

      for (const tr of tbody.querySelectorAll('tr')) {
        const price = parseNumber(tr.querySelector('.price')?.value ?? '');
        const qty = parseNumber(tr.querySelector('.qty')?.value ?? '');
        const total = price * qty;

        tr.querySelector('.row-total').textContent = fmt(total);
        grand += total;
      }

      grandTotalEl.textContent = fmt(grand);
    }

    function applyGlobalPrice() {
      const gp = globalPriceEl.value; // оставляем как ввели
      for (const priceInput of tbody.querySelectorAll('.price')) {
        priceInput.value = gp;
      }
      recalc();
    }

    // Глобальная цена
    globalPriceEl.addEventListener('input', applyGlobalPrice);

    // Пересчет при вводе в таблице (кроме "Другой Подарок" qty — он readonly)
    tbody.addEventListener('input', (e) => {
      if (e.target.matches('.price, .qty')) recalc();
    });

    // Подсчет мелких подарков
    [small1El, small2El, small3El].forEach(el => {
      el.addEventListener('input', updateSmallGiftsSum);
    });

    // Сброс
    resetBtn.addEventListener('click', () => {
      globalPriceEl.value = '';

      for (const tr of tbody.querySelectorAll('tr')) {
        tr.querySelector('.price').value = '';
      }

      // обычные количества
      const rows = tbody.querySelectorAll('tr');
      rows[0].querySelector('.qty').value = '1';
      rows[1].querySelector('.qty').value = '1';

      // мелкие подарки
      small1El.value = '0';
      small2El.value = '0';
      small3El.value = '0';

      updateSmallGiftsSum(); // обновит otherQty и пересчитает
    });

    // Инициализация
    updateSmallGiftsSum();
  </script>
</body>
</html>